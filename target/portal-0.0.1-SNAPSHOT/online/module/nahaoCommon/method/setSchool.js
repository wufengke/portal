define("module/common/method/setSchool",["lib/artDialog/4.1.7/artDialog","lib/Validform/5.3.2/Validform"],function(require,exports){$(".resetSchool").live("click",function(){var _this=$(this);$.ajax({url:siteUrl+"school?id=1",type:"GET",dataType:"json",success:function(json){for(var listr="",i=0;i<json.length;++i)listr+='<li data-id="'+json[i].id+'" ismunicipality="'+json[i].ismunicipality+'">'+json[i].name+"</li>";if($(".resetSchoolPopCon .province").html(listr),$(".resetSchoolPopCon .province").fadeIn(),"1"==_this.attr("set")){var _province=_this.attr("province"),_city=_this.attr("city"),_county=_this.attr("county");exports.normalData({province:_province,city:_city,county:_county})}}}),require("lib/artDialog/4.1.7/artDialog"),$.dialog({id:"setSchollID",title:"选择学校",top:100,content:$("#resetSchoolPop").html().replace("resetSchoolPopCon_beta","resetSchoolPopCon"),icon:null,width:800,ok:function(){$(".theGenusScholl_n").addClass("undis"),$(".theGenusScholl_y").removeClass("undis");var school_id=($("#class_id").val(),$(".aui_content .school li.active").attr("data-id")),province=$(".resetSchoolPopCon .schoolProvice li.active").html(),city=$(".resetSchoolPopCon .schoolCity li.active").html(),county=$(".resetSchoolPopCon .schoolCounty li.active").html(),province_id=$(".resetSchoolPopCon .province li.active").attr("data-id"),city_id=$(".resetSchoolPopCon .city li.active").attr("data-id"),county_id=$(".resetSchoolPopCon .schoolCounty li.active").attr("data-id"),sctype_id=$(".resetSchoolPopCon .schoolGrade li.active").attr("data-id"),schoolname=$(".resetSchoolPopCon .schoolName li.active").html(),seacherResultname=$(".resetSchoolPopCon .schoolInfo .seacherResult li.active").html(),searcherResultid=$(".schoolInfo .seacherResult li.active").attr("data-id"),writeSchoolName=$(".resetSchoolPopCon .writeSchoolName").val();if("undefined"==typeof province&&(province=""),"undefined"==typeof city&&(city=""),"undefined"==typeof county&&(county=""),"undefined"==typeof writeSchoolName&&(writeSchoolName=""),"undefined"==typeof seacherResultname&&(seacherResultname=""),"undefined"==typeof schoolname&&(schoolname=""),"undefined"==typeof city&&(city=""),""==schoolname&&""==seacherResultname&&""==writeSchoolName)return this.close(),!1;var fullname=province+city+county+schoolname+seacherResultname+writeSchoolName;searcherResultid&&(school_id=searcherResultid),_this.hasClass("resetSchool")?($(".theGenusScholl_n").add("undis"),$(".schoolFullName").val(fullname),$(".resetSchool").text("重设学校"),$("#schoolVal").val(school_id)):($("#schoolVal").val(school_id),$(".schoolFullName").val(fullname),$(".resetSchool").text("重设学校"),$("#schoolVal").val()>0&&$(".schoolBox").find(".ValidformInfo,.Validform_checktip").hide()),$("#province_id").val(province_id),$("#city_id").val(city_id),$("#schoolname").val(writeSchoolName),$("#area_county_id").val(county_id),$("#school_type").val(sctype_id)},cancel:!0,close:function(){$(".resetSchoolPopCon .city,.resetSchoolPopCon .county,.resetSchoolPopCon .sctype,.resetSchoolPopCon .schoolInfo").hide()}}),exports.showSchool(),exports.noMyScholl(),exports.seacherSchoolValid(),exports.seacheSchoolResult()}),exports.seacheSchoolResult=function(){$("span.reset").click(function(){$(".schoolNames").val(""),$(".seacherResult").hide(),$(".school").fadeIn(),$("span.reset").addClass("undis")})},exports.seacherSchoolValid=function(){require("lib/Validform/5.3.2/Validform");var _Form=$(".seacherSchoolForm").Validform({tiptype:function(msg,o){if(!o.obj.is("form")){var objtip=o.obj.next().find(".Validform_checktip");objtip.text(msg),o.obj.next().show();var objtip=o.obj.next().find(".Validform_checktip");objtip.text(msg);var infoObj=o.obj.next(".ValidformTips");2==o.type&&(infoObj.show(),o.obj.next().hide())}},showAllError:!1,ajaxPost:!0,callback:function(){var words=$(".schoolNames").val();""!=$.trim(words)?/.*[\u4e00-\u9fa5]+.*$/.test(words)?$.ajax({url:siteUrl+"school/convert?chinese="+encodeURIComponent(words),type:"GET",dataType:"json",success:function(json){words=json.py,exports.query(words)}}):exports.query(words):exports.buildSchool(),$(".school").hide(),$(".seacherResult").fadeIn(),$("span.reset").removeClass("undis").show()}});_Form.addRule([{ele:".schoolNames",datatype:"*",nullmsg:"请输入学校名称",errormsg:"学校名称输入错误"}])},exports.query=function(words){var _li="";$.each(school_array,function(k,v){$.each(v,function(k2,v2){"undefined"!=typeof words&&""!=$.trim(words)&&(-1!=v2.schoolname.indexOf(words)||-1!=v2.py.indexOf(words)||-1!=v2.first_py.indexOf(words))&&(_li+='<li data-id="'+v2.id+'">'+v2.schoolname+"</li>")})}),""==_li&&(_li="没有找到相关学校，请重新输入关键词。"),$(".seacherResult ul").html(_li)},exports.buildSchool=function(query){$(".resetSchoolPopCon .schoolInfo").fadeIn();var listr="";$.each(school_array,function(k,v){var total=0,asort="<dl class='cf'><dt class='fl'>"+k.toUpperCase()+"</dt><dd class='fr'><ul>";$.each(v,function(k2,v2){"undefined"!=typeof query&&""!=$.trim(query)?(-1!=v2.schoolname.indexOf(query)||-1!=v2.py.indexOf(query)||-1!=v2.first_py.indexOf(query))&&(listr+='<li data-id="'+v2.id+'" title="'+v2.schoolname+'">'+v2.schoolname+"</li>"):(asort+='<li data-id="'+v2.id+'" title="'+v2.schoolname+'">'+v2.schoolname+"</li>",total++)}),asort+="</ul></dd></dl>",total>0&&(listr+=asort)}),"undefined"!=typeof query&&""!=$.trim(query)?$(".school").html("<dl>"+listr+"</dl>"):$(".school").html(listr),$(".school").css("display","block")},exports.showSchool=function(){$(".resetSchoolPopCon .province li").live("click",function(){$(".resetSchoolPopCon .schoolNames").focus(function(){return!1}),$(".seacherResult").hide(),$("span.reset").addClass("undis"),$(".resetSchoolPopCon .seacherSchoolForm").Validform().resetForm(),$(".ValidformInfo").hide();$(this);$(".resetSchoolPopCon .sctype").hide();var _cityName=2==$(this).attr("data-id")||25==$(this).attr("data-id")||27==$(this).attr("data-id")||32==$(this).attr("data-id")||33==$(this).attr("data-id")||34==$(this).attr("data-id")||35==$(this).attr("data-id");if(_cityName?$(".resetSchoolPopCon .city,.resetSchoolPopCon .sctype,.resetSchoolPopCon .schoolInfo").hide():$(".resetSchoolPopCon .county,.resetSchoolPopCon .schoolInfo").hide(),"active"!==$(this).attr("class")){var id=$(this).attr("data-id"),ismunicipality=$(this).attr("ismunicipality");$.ajax({url:siteUrl+"school?id="+id,type:"GET",dataType:"json",success:function(json){for(var listr="",i=0;i<json.length;++i)listr+='<li data-id="'+json[i].id+'">'+json[i].name+"</li>";if(1==ismunicipality){$(".resetSchoolPopCon .county").html(listr).fadeIn(),$(".resetSchoolPopCon .county li").first().addClass("active");var _this=$(".resetSchoolPopCon .county li.active");$(".resetSchoolPopCon .sctype,.resetSchoolPopCon .schoolInfo").hide(),$.ajax({url:siteUrl+"school/type",type:"GET",dataType:"json",success:function(json){for(var listr="",i=0;i<json.length;++i)listr+='<li data-id="'+json[i].id+'">'+json[i].name+"</li>";$(".resetSchoolPopCon .sctype").html(listr).fadeIn(),$(".resetSchoolPopCon .sctype li").first().addClass("active");var sctype=1,county_id=$(".resetSchoolPopCon .county li").first().attr("data-id");$.ajax({url:siteUrl+"school/get_school",type:"GET",dataType:"json",data:{id:county_id,sctype:sctype},success:function(json){school_array=json,exports.buildSchool()}})}})}else{$(".resetSchoolPopCon .city").html(listr).fadeIn(),$(".resetSchoolPopCon .city li").first().addClass("active");var _this=$(".resetSchoolPopCon .city li.active");$(".resetSchoolPopCon .sctype,.resetSchoolPopCon .schoolInfo").hide();var id=_this.attr("data-id");$.ajax({url:siteUrl+"school?id="+id,type:"GET",dataType:"json",success:function(json){for(var listr="",i=0;i<json.length;++i)listr+='<li data-id="'+json[i].id+'">'+json[i].name+"</li>";$(".resetSchoolPopCon .county").html(listr).show(),$(".resetSchoolPopCon .county li").first().addClass("active");$(".resetSchoolPopCon .county li.active");$(".resetSchoolPopCon .sctype,.resetSchoolPopCon .schoolInfo").hide(),$.ajax({url:siteUrl+"school/type",type:"GET",dataType:"json",success:function(json){for(var listr="",i=0;i<json.length;++i)listr+='<li data-id="'+json[i].id+'">'+json[i].name+"</li>";$(".resetSchoolPopCon .sctype").html(listr).fadeIn(),$(".resetSchoolPopCon .sctype li").first().addClass("active");var sctype=1,county_id=$(".resetSchoolPopCon .county li").first().attr("data-id");$.ajax({url:siteUrl+"school/get_school",type:"GET",dataType:"json",data:{id:county_id,sctype:sctype},success:function(json){school_array=json,exports.buildSchool(),exports.seacherSchoolValid()}})}})}})}}})}}),$(".resetSchoolPopCon .city li").live("click",function(){if($(".resetSchoolPopCon .schoolNames").focus(function(){return!1}),$(".seacherResult").hide(),$("span.reset").addClass("undis"),$(".resetSchoolPopCon .sctype,.resetSchoolPopCon .schoolInfo").hide(),$(".resetSchoolPopCon .seacherSchoolForm").Validform().resetForm(),$(".ValidformInfo").hide(),"active"!==$(this).attr("class")){var id=$(this).attr("data-id");$.ajax({url:siteUrl+"school?id="+id,type:"GET",dataType:"json",success:function(json){for(var listr="",i=0;i<json.length;++i)listr+='<li data-id="'+json[i].id+'">'+json[i].name+"</li>";$(".resetSchoolPopCon .county").html(listr).show(),$(".resetSchoolPopCon .county li").first().addClass("active");$(".resetSchoolPopCon .county li.active");$(".resetSchoolPopCon .sctype,.resetSchoolPopCon .schoolInfo").hide(),$.ajax({url:siteUrl+"school/type",type:"GET",dataType:"json",success:function(json){for(var listr="",i=0;i<json.length;++i)listr+='<li data-id="'+json[i].id+'">'+json[i].name+"</li>";$(".resetSchoolPopCon .sctype").html(listr).fadeIn(),$(".resetSchoolPopCon .sctype li").first().addClass("active");var sctype=1,county_id=$(".resetSchoolPopCon .county li").first().attr("data-id");$.ajax({url:siteUrl+"school/get_school",type:"GET",dataType:"json",data:{id:county_id,sctype:sctype},success:function(json){school_array=json,exports.buildSchool(),exports.seacherSchoolValid()}})}})}})}}),$(".resetSchoolPopCon .county li").live("click",function(){$(".resetSchoolPopCon .schoolNames").focus(function(){return!1}),_this=$(this),$(".seacherResult").hide(),$("span.reset").addClass("undis"),$(".resetSchoolPopCon .sctype,.resetSchoolPopCon .schoolInfo").hide(),$(".resetSchoolPopCon .seacherSchoolForm").Validform().resetForm(),$(".ValidformInfo").hide(),$.ajax({url:siteUrl+"school/type",type:"GET",dataType:"json",success:function(json){for(var listr="",i=0;i<json.length;++i)listr+='<li data-id="'+json[i].id+'">'+json[i].name+"</li>";$(".resetSchoolPopCon .sctype").html(listr).fadeIn(),$(".resetSchoolPopCon .sctype li").first().addClass("active");var sctype=1,county_id=_this.attr("data-id");$.ajax({url:siteUrl+"school/get_school",type:"GET",dataType:"json",data:{id:county_id,sctype:sctype},success:function(json){school_array=json,exports.buildSchool()}})}})}),$(".resetSchoolPopCon .sctype li").live("click",function(){if($(".resetSchoolPopCon .schoolNames").focus(function(){return!1}),$(".seacherResult").hide(),$("span.reset").addClass("undis"),$(".resetSchoolPopCon .seacherSchoolForm").Validform().resetForm(),$(".ValidformInfo").hide(),$(".resetSchoolPopCon .schoolInfo,.resetSchoolPopCon .schoolInfo .hd").show(),$(".resetSchoolPopCon .schoolNames").val(""),$(".resetSchoolPopCon .schoolInfo .seacherResult,.resetSchoolPopCon .schoolInfo .reset,.resetSchoolPopCon .schoolInfo .bd").hide(),"active"!==$(this).attr("class")){var sctype=$(this).attr("data-id"),county_id=$(".aui_content .county li.active").attr("data-id");$.ajax({url:siteUrl+"school/get_school",type:"GET",dataType:"json",data:{id:county_id,sctype:sctype},success:function(json){school_array=json,exports.buildSchool()}})}}),$(".schooLocation li").live("click",function(){$(this).addClass("active").siblings().removeClass("active")}),$(".school li").live("click",function(){$(".seacherResult").hide(),$("span.reset").addClass("undis"),$(".school li").removeClass("active"),$(this).addClass("active")}),$(".seacherResult li").live("click",function(){$(".seacherResult li").removeClass("active"),$(this).addClass("active")})},exports.noMyScholl=function(){$(".noMySchollBtn").live("click",function(){$(".resetSchoolPopCon .schoolInfo .hd,.resetSchoolPopCon .schoolInfo .seacherResult").hide(),$(".resetSchoolPopCon .school").hide(),$(".resetSchoolPopCon .schoolInfo .bd").fadeIn()}),$(".returnSetSchool").live("click",function(){$(".resetSchoolPopCon .schoolInfo .bd").hide(),$(".resetSchoolPopCon .schoolInfo .hd").fadeIn(),$(".resetSchoolPopCon .school").fadeIn()})},exports.normalData=function(_json){$(".resetSchoolPopCon .province li").each(function(){if($(this).attr("data-id")==_json.province){$(this).addClass("active");var _cityName=2==$(this).attr("data-id")||25==$(this).attr("data-id")||27==$(this).attr("data-id")||32==$(this).attr("data-id")||33==$(this).attr("data-id")||34==$(this).attr("data-id")||35==$(this).attr("data-id");_cityName?$(".resetSchoolPopCon .city,.resetSchoolPopCon .sctype,.resetSchoolPopCon .schoolInfo").hide():$(".resetSchoolPopCon .county,.resetSchoolPopCon .schoolInfo").hide();var ismunicipality=$(this).attr("ismunicipality");$.ajax({url:siteUrl+"school?id="+_json.province,type:"GET",dataType:"json",success:function(json){for(var listr="",i=0;i<json.length;++i)listr+='<li data-id="'+json[i].id+'">'+json[i].name+"</li>";1==ismunicipality?($(".resetSchoolPopCon .county").html(listr).fadeIn(),$(".resetSchoolPopCon .county li").each(function(){$(this).attr("data-id")==_json.county&&($(this).addClass("active"),$(".resetSchoolPopCon .sctype,.resetSchoolPopCon .schoolInfo").hide(),$.ajax({url:siteUrl+"school/type",type:"GET",dataType:"json",success:function(json){for(var listr="",i=0;i<json.length;++i)listr+='<li data-id="'+json[i].id+'">'+json[i].name+"</li>";$(".resetSchoolPopCon .sctype").html(listr).fadeIn(),$(".resetSchoolPopCon .sctype li").first().addClass("active");var sctype=1,county_id=$(".resetSchoolPopCon .county li").first().attr("data-id");$.ajax({url:siteUrl+"school/get_school",type:"GET",dataType:"json",data:{id:county_id,sctype:sctype},success:function(json){school_array=json,exports.buildSchool(),exports.seacherSchoolValid()}})}}))})):($(".resetSchoolPopCon .city").html(listr),$(".resetSchoolPopCon .city li").each(function(){if($(this).attr("data-id")==_json.city){$(this).addClass("active"),$(".resetSchoolPopCon .sctype,.resetSchoolPopCon .schoolInfo").hide();{$(this).attr("data-id")}$.ajax({url:siteUrl+"school?id="+_json.city,type:"GET",dataType:"json",success:function(json){for(var listr="",i=0;i<json.length;++i)listr+='<li data-id="'+json[i].id+'">'+json[i].name+"</li>";$(".resetSchoolPopCon .county").html(listr).show(),$(".resetSchoolPopCon .county li").each(function(){$(this).attr("data-id")==_json.county&&($(this).addClass("active"),$(".resetSchoolPopCon .sctype,.resetSchoolPopCon .schoolInfo").hide(),$.ajax({url:siteUrl+"school/type",type:"GET",dataType:"json",success:function(json){for(var listr="",i=0;i<json.length;++i)listr+='<li data-id="'+json[i].id+'">'+json[i].name+"</li>";$(".resetSchoolPopCon .sctype").html(listr),$(".resetSchoolPopCon .sctype").fadeIn()}}))})}})}}),$(".resetSchoolPopCon .city").fadeIn())}})}})}});